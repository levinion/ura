#!/bin/python

import argparse
import os


def list_plugins(path):
    try:
        entrys = os.listdir(path)
        for entry in entrys:
            if os.path.isdir(os.path.join(path, entry)):
                print(entry)
    except FileNotFoundError:
        pass
    except Exception as e:
        print(e)
        exit(1)


def main():
    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers(dest="command")
    subparsers.add_parser("list", help="list plugins")
    install = subparsers.add_parser("install", help="install a plugin")
    install.add_argument("url", type=str)
    uninstall = subparsers.add_parser("uninstall", help="uninstall a plugin")
    uninstall.add_argument("plugin", type=str)
    args = parser.parse_args()

    base = os.path.expanduser("~/.local/share/ura/plugins/")

    match args.command:
        case "list":
            list_plugins("/usr/share/ura/plugins/")
            list_plugins(base)
        case "install":
            os.makedirs(base, exist_ok=True)
            os.execvp(
                "git",
                [
                    "git",
                    "-C",
                    base,
                    "clone",
                    args.url,
                ],
            )
        case "uninstall":
            pass
        case _:
            parser.print_help()


if __name__ == "__main__":
    main()
